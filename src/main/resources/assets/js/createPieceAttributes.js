//CREATED BY IRVIN UMAÃ‘A

/**
* Card click event handler: clears all cards from the selectedCard Class, and add it to the clicked (selected card)
* @card: The clicked card instance. 
* @return: void. 
*/
function checkCard(card){
	$(".attribute-card").removeClass("selectedCard");
	$(card).addClass("selectedCard");
}

/**
* Deletes a selected card using the selectedCard class. 
* @card_button: the delete card button (not the actual card instance). 
* @return: void. 
*/
function deleteCard(card_button) {
	//TODO Verify with the user. 
	$(card_button).addClass("selectedCard");
	$(".attribute-card").has(".selectedCard").fadeOut( "slow", function() {
    	this.remove();
  });
}

/**
* Add a card (generated by a template), as to allow the input of a property. 
* @return: void. 
*/
function addProperty(){
	console.log($(".cardTemplate").length);
	var newCard = $(".cardTemplate").clone().attr("display","inline-block").removeClass("cardTemplate");
	$("#attribute-card-list").append(newCard);
	
}

function saveAttributes(){
    var text = [];
    var attributes = "{\n";

    $("input").each(function() {
        text.push($(this).val());
    });
    for(i = 3; i < text.length; i = i+2){
        attributes += "\"" + text[i] + "\": \"" + text[i+1] + "\"";
        if(i < text.length - 2){
            attributes += ",\n";
        }
    }
    attributes += "\n}";

    var result = false;

        $.ajax({
            url: "/methods/saveAttributes",
            type: 'POST',
            data: JSON.stringify({
                auth: {
                    userID: Cookies.get("userID"),
                    accessToken: Cookies.get("accessToken")
                },
                piece: JSON.parse(attributes)
            }),
            contentType: "text/plain",
            success:function(data, textStatus, jqXHR){
                if(data == "Repeated"){
                    alert("There are another piece with the sames attributes.\n" +
                    "Please change, add or delete one in your current" +
                    "piece to be able to save it.")
                    result =  false
                } else {
                    alert("Piece successfully saved in the server.")
                    console.log("attributes saved in server directory")
                    result =  true
                }
            },
            error:function(jqXHR, textStatus, errorThrown ){
                console.log(errorThrown);
                result = false
            },
            async:false
        });

    return result;
}