//CREATED BY IRVIN UMAÃ‘A

/**
* Card click event handler: clears all cards from the selectedCard Class, and add it to the clicked (selected card)
* @card: The clicked card instance. 
* @return: void. 
*/
function checkCard(card){
	$(".attribute-card").removeClass("selectedCard");
	$(card).addClass("selectedCard");
}

/**
* Deletes a selected card using the selectedCard class. 
* @card_button: the delete card button (not the actual card instance). 
* @return: void. 
*/
function deleteCard(card_button) {
	//TODO Verify with the user. 
	$(card_button).addClass("selectedCard");
	$(".attribute-card").has(".selectedCard").fadeOut( "slow", function() {
    	this.remove();
  });
}

/**
* Add a card (generated by a template), as to allow the input of a property. 
* @return: void. 
*/
function addProperty(){
	console.log($(".cardTemplate").length);
	var newCard = $(".cardTemplate").clone().attr("display","inline-block").removeClass("cardTemplate");
	$("#attribute-card-list").append(newCard);
	
}

function saveAttributes(){
    var required = [];
    var optional = [];
    var requiredAttributes = "{\n";
    var optionalAttributes = "{\n";

    //$("attributes-card-list label[]]")

    $("#attribute-card-list input[type = required]").each(function() {
        required.push($(this).val())
    })

    $("#attribute-card-list input[type = optional]").each(function() {
        if($(this).val() != "") {
            optional.push($(this).val())
        }
    })

    $("#attribute-card-list input[type = checkbox]").each(function() {
        required.push($(this).val())
    })

    for(i = 0; i < required.length; i = i+2){
        requiredAttributes += "\"" + required[i] + "\": \"" + required[i+1] + "\"";
        if(i < required.length - 2){
            requiredAttributes += ",\n";
        }
    }

    for(i = 0; i < optional.length; i = i+2){
        optionalAttributes += "\"" + optional[i] + "\": \"" + optional[i+1] + "\"";
        if(i < optional.length - 2){
            optionalAttributes += ",\n";
        }
    }
    optionalAttributes += "\n}";

    var attributes = requiredAttributes + ", \"optional\":" + optionalAttributes + "\n}";

    var result = false;

        $.ajax({
            url: "/methods/saveAttributes",
            type: 'POST',
            data: JSON.stringify({
                auth: {
                    userID: Cookies.get("userID"),
                    accessToken: Cookies.get("accessToken")
                },
                piece: JSON.parse(attributes)
            }),
            contentType: "text/plain",
            success:function(data, textStatus, jqXHR){
                if(data == "Repeated"){
                    alert("There are another piece with the sames attributes.\n" +
                    "Please change, add or delete one in your current" +
                    "piece to be able to save it.")
                    result =  false
                } else {
                    alert("Piece successfully saved in the server.")
                    console.log("attributes saved in server directory")
                    result =  true
                }
            },
            error:function(jqXHR, textStatus, errorThrown ){
                console.log(errorThrown);
                result = false
            },
            async:false
        });

    return result;
}

///Event listerners (with anonymous even handlers) for the different menus. 
//Toggle open, or close the tool's menu.


$( "#properties-nav-btn" ).click(function() {
  $( "#attributes-menu-content" ).toggle( "slow", function() {
  });
});